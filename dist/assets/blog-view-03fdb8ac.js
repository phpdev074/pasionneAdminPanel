import{t as P,r as h,j as e,T as k,P as d,A as Y,I as Z,v as B,w as D,M as O,S as ee,x as se}from"./index-4c1f21a2.js";import{a as T}from"./axios-9cbf0d09.js";import{b as R}from"./axios-cbe97543.js";import{c as re,a as E,u as oe,C as te}from"./CircularProgress-e3d5e951.js";import{S as U,A as N}from"./sweetalert2.esm.all-d5060261.js";import{C as L}from"./Container-bd9c5fdb.js";import{B as v}from"./Button-a1bdae01.js";import{T as ne}from"./TextField-e4a808c0.js";import{G as C}from"./Grid-d47a6c9f.js";import{T as H,a as j,b as ie,c as le,d as ae,e as ce,f as de}from"./TableSortLabel-1eac3fb8.js";import{D as M,c as W,a as he,b as ue,S as z}from"./DialogTitle-ba3b5774.js";const me=P(L)(({theme:t})=>({display:"flex",flexDirection:"column",justifyContent:"left",alignItems:"left",minHeight:"100vh",padding:t.spacing(4),borderRadius:"8px",boxShadow:t.shadows[3],backgroundColor:t.palette.background.paper,position:"relative"})),$=P(v)(({theme:t})=>({marginTop:t.spacing(2),backgroundColor:t.palette.primary.main,color:t.palette.common.white,"&:hover":{backgroundColor:t.palette.primary.dark},width:"20%"})),A=P(ne)(({theme:t})=>({marginTop:t.spacing(2),width:"100%"})),ge=re({title:E().required("Title is required").min(5,"Title must be at least 5 characters long"),description:E().required("Description is required").min(10,"Description must be at least 10 characters long"),header:E().required("Header is required").min(5,"Header must be at least 5 characters long")}),V=({onSubmit:t,onClose:p,initialData:s})=>{const[i,u]=h.useState(!1),[x,y]=h.useState(null),r=oe({initialValues:{title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",header:(s==null?void 0:s.header)||"",blogImage:null},validationSchema:ge,enableReinitialize:!0,onSubmit:async m=>{var a;try{u(!0);let b=s==null?void 0:s.uploadImages;if(m.blogImage){const o=new FormData;o.append("image",m.blogImage);const l=await T.post("https://pasionneapi.codingacademy.world/api/user/upload-images",o,{headers:{"Content-Type":"multipart/form-data"}});if(b=(a=l==null?void 0:l.data)==null?void 0:a.data.fileName,!b)throw new Error("Image upload failed")}const g={title:m.title,description:m.description,header:m.header,uploadImages:b};await t(g),u(!1),U.fire({icon:"success",title:"Success",text:s?"Blog updated successfully!":"Blog created successfully!"}),p()}catch{u(!1),U.fire({icon:"error",title:"Error",text:"An error occurred while uploading the image or submitting the form."})}}}),f=m=>{const a=m.currentTarget.files[0];a&&(r.setFieldValue("blogImage",a),y(URL.createObjectURL(a)))};return h.useEffect(()=>{s!=null&&s.uploadImages&&y(` https://pasionneapi.codingacademy.world/public/uploadImages/${s.uploadImages}`)},[s]),e.jsxs(me,{maxWidth:!1,children:[e.jsx(k,{variant:"h4",align:"left",gutterBottom:!0,children:s?"Edit Blog":"Add Blog"}),e.jsxs("form",{onSubmit:r.handleSubmit,style:{width:"100%",maxWidth:"600px"},children:[e.jsxs(C,{container:!0,spacing:2,children:[e.jsx(C,{item:!0,xs:12,children:e.jsx(A,{label:"Title",variant:"outlined",name:"title",value:r.values.title,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.title&&!!r.errors.title,helperText:r.touched.title&&r.errors.title})}),e.jsx(C,{item:!0,xs:12,children:e.jsx(A,{label:"Description",variant:"outlined",multiline:!0,rows:4,name:"description",value:r.values.description,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.description&&!!r.errors.description,helperText:r.touched.description&&r.errors.description})}),e.jsx(C,{item:!0,xs:12,children:e.jsx(A,{label:"Header",variant:"outlined",name:"header",value:r.values.header,onChange:r.handleChange,onBlur:r.handleBlur,error:r.touched.header&&!!r.errors.header,helperText:r.touched.header&&r.errors.header})}),e.jsxs(C,{item:!0,xs:12,children:[e.jsx(k,{variant:"subtitle1",children:"Upload Blog Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:f,style:{marginTop:"8px"}})]}),x&&e.jsxs(C,{item:!0,xs:12,children:[e.jsx(k,{variant:"subtitle1",children:"Image Preview:"}),e.jsx("img",{src:x,alt:"Preview",style:{width:"50%",maxWidth:"300px",height:"150px",marginTop:"8px",borderRadius:"8px",border:"1px solid #ccc"}})]})]}),i?e.jsx(te,{sx:{marginTop:2}}):e.jsxs(e.Fragment,{children:[e.jsx($,{type:"submit",sx:{marginRight:2},children:s?"Update":"Submit"}),!s&&e.jsx($,{type:"button",onClick:p,children:"Cancel"})]})]})]})};V.propTypes={initialData:d.object,onSubmit:d.func.isRequired,onClose:d.func.isRequired};const G=V;function q({description:t,selected:p,nameEN:s,nameHN:i,images:u,id:x,onModification:y}){const[r,f]=h.useState(null),[m,a]=h.useState(!1),[b,g]=h.useState(!1),[o,l]=h.useState({open:!1,message:"",severity:""}),w=n=>f(n.currentTarget),c=()=>f(null),J=()=>{a(!0),c()},F=()=>a(!1),K=async()=>{var n,S;try{await T.delete(`${R}testimonial/delete-blogs`,{params:{id:x}}),l({open:!0,message:"Item deleted successfully",severity:"success"}),y(),g(!1)}catch(I){l({open:!0,message:((S=(n=I.response)==null?void 0:n.data)==null?void 0:S.message)||"Failed to delete item",severity:"error"})}},Q=async n=>{var S,I;try{await T.put(`${R}testimonial/edit-blog?id=${x}`,{title:n==null?void 0:n.title,description:n==null?void 0:n.description,images:n==null?void 0:n.uploadImages,header:n==null?void 0:n.header}),l({open:!0,message:"Blog updated successfully",severity:"success"}),y(),a(!1)}catch(X){l({open:!0,message:((I=(S=X.response)==null?void 0:S.data)==null?void 0:I.message)||"Failed to update blog",severity:"error"})}};return e.jsxs(e.Fragment,{children:[e.jsxs(H,{hover:!0,tabIndex:-1,role:"checkbox",selected:p,children:[e.jsx(j,{padding:"checkbox"}),e.jsx(j,{children:e.jsx(Y,{alt:"Blog Image",src:u?` https://pasionneapi.codingacademy.world/public/uploadImages/${u}`:"/path/to/default/image.jpg"})}),e.jsx(j,{children:s}),e.jsx(j,{children:i}),e.jsx(j,{align:"left",children:e.jsx(Z,{onClick:w,children:e.jsx(B,{icon:"eva:more-vertical-fill"})})})]}),e.jsxs(D,{open:!!r,anchorEl:r,onClose:c,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:140}},children:[e.jsxs(O,{onClick:J,children:[e.jsx(B,{icon:"eva:edit-fill",sx:{mr:2}}),"Edit"]}),e.jsxs(O,{onClick:()=>g(!0),children:[e.jsx(B,{icon:"eva:trash-2-outline",sx:{mr:2}}),"Delete"]})]}),e.jsxs(M,{open:m,onClose:F,children:[e.jsx(G,{initialData:{title:s,header:i,description:t,uploadImages:u},onClose:F,onSubmit:Q}),e.jsx(W,{sx:{justifyContent:"flex-end",position:"absolute",marginTop:83.5,right:16},children:e.jsx(v,{onClick:F,variant:"contained",children:"Cancel"})})]}),e.jsxs(M,{open:b,onClose:()=>g(!1),children:[e.jsx(he,{children:"Confirm Delete"}),e.jsx(ue,{children:"Are you sure you want to delete this item?"}),e.jsxs(W,{children:[e.jsx(v,{onClick:()=>g(!1),color:"primary",children:"Cancel"}),e.jsx(v,{onClick:K,color:"secondary",children:"Delete"})]})]}),e.jsx(z,{open:o.open,autoHideDuration:6e3,onClose:()=>l(n=>({...n,open:!1})),children:e.jsx(N,{onClose:()=>l(n=>({...n,open:!1})),severity:o.severity,sx:{width:"100%"},children:o.message})})]})}q.propTypes={selected:d.bool,nameEN:d.string,nameHN:d.string,images:d.string,description:d.string,id:d.string.isRequired,onModification:d.func.isRequired};function _({headLabel:t,onRequestSort:p}){const s=i=>u=>{p(u,i)};return e.jsx(ie,{children:e.jsxs(H,{children:[e.jsx(j,{padding:"checkbox",children:"Â "}),t.map(i=>e.jsx(j,{align:i.align||"left",sx:{width:i.width,minWidth:i.minWidth},children:e.jsx(le,{hideSortIcon:!0,onClick:s(i.id),children:i.label})},i.id))]})})}_.propTypes={headLabel:d.array,onRequestSort:d.func};function Ie(){const[t,p]=h.useState([]),[s,i]=h.useState(!1),[u,x]=h.useState(!1),[y,r]=h.useState(""),f=async()=>{var l,w;const o=localStorage.getItem("token");if(!o){console.error("No token found");return}try{const c=await T.get(" https://pasionneapi.codingacademy.world/api/testimonial/get-blogs",{headers:{Authorization:o}});console.log("response?.data?.data.....",(l=c==null?void 0:c.data)==null?void 0:l.data),p((w=c==null?void 0:c.data)==null?void 0:w.data)}catch(c){console.error("Error fetching user data:",c.message),alert(c.message)}};h.useEffect(()=>{f()},[]);const m=()=>{i(!0)},a=()=>{i(!1)},b=async o=>{try{console.log("=====>>>>>newData",o),await T.post(`${R}testimonial/create-blogs`,{title:o.title,description:o.description,images:o.uploadImages,header:o.header}),f(),r("Blogs added successfully"),x(!0),i(!1)}catch(l){console.error("Error submitting form data:",l.message),alert(l.message)}},g=()=>{x(!1)};return e.jsxs(L,{children:[e.jsxs(ee,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(k,{variant:"h4",children:"Blogs"}),!s&&e.jsx(v,{variant:"contained",color:"inherit",onClick:m,startIcon:e.jsx(B,{icon:"eva:plus-fill"}),children:"Add New Blogs"})]}),s?e.jsx(G,{onSubmit:b,onClose:a}):e.jsx(se,{children:e.jsx(ae,{sx:{overflow:"unset"},children:e.jsxs(ce,{sx:{minWidth:800},children:[e.jsx(_,{headLabel:[{id:"blogImage",label:"Blog Image"},{id:"title",label:"Title"},{id:"header",label:"Header"},{id:"",label:"Action"}],rowCount:q.length}),e.jsx(de,{children:(t==null?void 0:t.length)>0?t.map(o=>e.jsx(q,{nameEN:o.title,nameHN:o.header,images:o.images,description:o.description,id:o._id,onModification:f},o._id)):e.jsx(H,{children:e.jsx(j,{colSpan:6,align:"center",children:e.jsx("div",{style:{marginTop:"10%",fontWeight:"bold"},children:"No Data Found"})})})})]})})}),e.jsx(z,{open:u,autoHideDuration:6e3,onClose:g,children:e.jsx(N,{onClose:g,severity:"success",sx:{width:"100%"},children:y})})]})}export{Ie as B};
